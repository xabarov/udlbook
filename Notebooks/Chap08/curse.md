Идея “кожуры” в высоких размерностях — это следствие того, как **объём $d$-мерного шара** зависит от радиуса.

## 1) Что именно называется “кожурой”

Пусть есть $d$-мерный шар (гипершар) радиуса $R$. “Кожура” толщиной 1% радиуса — это слой между радиусами $0.99R$ и $R$:

- внутренний шар: радиус $0.99R$
- внешняя граница: радиус $R$
- “кожура”: все точки, для которых $0.99R \le \|x\| \le R$

---

## 2) Главный факт: объём шара масштабируется как $R^d$

Объём $d$-мерного шара радиуса $R$ имеет вид
$$
V_d(R) = C_d \, R^d,
$$
где $C_d$ — константа, зависящая от размерности (через $\pi$ и гамма-функцию), но **для нашей доли в кожуре она сократится**.

Тогда доля объёма, лежащая в “кожуре” толщиной 1%:

$$
\text{ShellFrac}(d) = \frac{V_d(R) - V_d(0.99R)}{V_d(R)}
= 1 - \frac{C_d (0.99R)^d}{C_d R^d}
= 1 - 0.99^d.
$$

Это ключевая формула: **всё зависит только от $0.99^d$**.

---

## 3) Почему доля резко растёт с размерностью

Число $0.99$ чуть меньше 1. В малых $d$ степень почти не меняет его, но в больших $d$ оно падает экспоненциально:

$$
0.99^d = e^{d \ln(0.99)} \approx e^{-0.01005\, d}.
$$

То есть доля в кожуре
$$
1 - 0.99^d \approx 1 - e^{-0.01005\, d}
$$
быстро стремится к 1 при росте $d$.

---

## 4) Проверим ваши числа (и увидим, что они естественно следуют из формулы)

Подставим:

- $d=2$: $\;1 - 0.99^2 = 1 - 0.9801 = 0.0199 \approx 2\%$
- $d=50$: $\;1 - 0.99^{50} \approx 1 - 0.605 \approx 0.395 \approx 40\%$
- $d=300$: $\;1 - 0.99^{300} \approx 1 - 0.049 \approx 0.951 \approx 95\%$

То есть эти “парадоксальные” проценты — прямое следствие $R^d$.

---

## 5) Интуиция без формул: почему “всё у края”

Можно думать так:

- В 1D шар — это отрезок. “Кожура” толщины 1% — это два маленьких кусочка по краям; их мало.
- В 2D шар — диск. Площадь концентрируется ближе к центру сильнее, чем “кажется”, поэтому тонкое кольцо даёт малую долю.
- В больших $d$ “радиус” становится **очень мощным множителем**: чуть-чуть уменьшили радиус с $R$ до $0.99R$ — и объём внутреннего шара уменьшается в $(0.99)^d$ раз. В больших $d$ это “чуть-чуть” превращается в огромную потерю объёма.

Ещё одна метафора: в высоких размерностях “большинство направлений” ведут наружу, и пространство “раздувается” так, что основная масса оказывается в тонком внешнем слое.

---

## 6) Обобщение: кожура толщиной $\varepsilon$

Если “кожура” — это внешний слой толщиной $\varepsilon R$ (например, $\varepsilon=0.01$), то внутренний радиус $(1-\varepsilon)R$, и доля в кожуре:

$$
\text{ShellFrac}(d,\varepsilon) = 1 - (1-\varepsilon)^d.
$$

Отсюда можно, например, оценить, какая размерность нужна, чтобы в кожуре было хотя бы $p$ доли объёма:

$$
1 - (1-\varepsilon)^d \ge p
\quad\Rightarrow\quad
d \ge \frac{\ln(1-p)}{\ln(1-\varepsilon)}.
$$

Например, при $\varepsilon=0.01$ и $p=0.95$ получаем $d \approx 298$, что совпадает по смыслу с примером про $300D$.

---

<details>
<summary><strong>7) Почему это важно в ML/данных (коротко)</strong></summary>

- В высоких размерностях “типичные” точки (например, из примерно равномерного распределения в шаре) почти всегда имеют норму близкую к $R$: они “живут” у границы.
- Это связано с явлениями концентрации меры: многие геометрические величины становятся почти константами (например, расстояния и нормы “схлопываются” к типичному значению).
- Отсюда растут эффекты вроде “все точки почти одинаково далеко”, что влияет на kNN, кластеризацию, выбор метрик и т.п.

</details>

