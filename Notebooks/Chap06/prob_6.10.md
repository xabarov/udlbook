Пусть SGD + momentum задано рекуррентно:

$$
m_{t+1}=\beta\, m_t+(1-\beta)\, g_t,
$$

где $g_t$ — градиент на шаге $t$ (например, по мини-батчу):

$$
g_t=\sum_{i\in B_t}\nabla_{\phi}\,\ell_i(\phi_t)
\quad\text{или}\quad
g_t=\frac{1}{|B_t|}\sum_{i\in B_t}\nabla_{\phi}\,\ell_i(\phi_t).
$$

---

## 1) Развёртка рекурсии

Последовательно подставим $m_t$ через $m_{t-1}$:

$$
\begin{aligned}
m_{t+1}
&=\beta m_t+(1-\beta)g_t \\
&=\beta\big(\beta m_{t-1}+(1-\beta)g_{t-1}\big)+(1-\beta)g_t \\
&=\beta^2 m_{t-1}+(1-\beta)\beta\, g_{t-1}+(1-\beta)g_t.
\end{aligned}
$$

Ещё на шаг назад:

$$
\begin{aligned}
m_{t+1}
&=\beta^2\big(\beta m_{t-2}+(1-\beta)g_{t-2}\big)+(1-\beta)\beta\, g_{t-1}+(1-\beta)g_t \\
&=\beta^3 m_{t-2}+(1-\beta)\beta^2 g_{t-2}+(1-\beta)\beta g_{t-1}+(1-\beta)g_t.
\end{aligned}
$$

Продолжая так дальше, после $k$ подстановок получаем общий вид:

$$
m_{t+1}=\beta^{t+1}m_0+(1-\beta)\sum_{j=0}^{t}\beta^{j}\, g_{t-j}.
$$

---

## 2) «Бесконечная» взвешенная сумма

Обычно берут $m_0=0$. Тогда

$$
m_{t+1}=(1-\beta)\sum_{j=0}^{t}\beta^{j}\, g_{t-j}.
$$

При больших $t$ это эквивалентно экспоненциально убывающей (геометрической) сумме всех прошлых градиентов; влияние далёких градиентов уменьшается как степень $\beta^{j}$.

---

## 3) Коэффициенты (веса)

В выражении

$$
m_{t+1}=(1-\beta)\sum_{j=0}^{t}\beta^{j}\, g_{t-j}
$$

вес при градиенте $g_{t-j}$ равен

$$
w_j=(1-\beta)\beta^{j},\qquad j=0,1,2,\dots
$$

То есть:

- вес у $g_t$ (самого свежего градиента): $w_0=1-\beta$;
- вес у $g_{t-1}$: $w_1=(1-\beta)\beta$;
- вес у $g_{t-2}$: $w_2=(1-\beta)\beta^2$;
- и т.д.

Если $m_0\neq 0$, то дополнительно есть член $\beta^{t+1}m_0$, который стремится к нулю при $|\beta|<1$.

Также полезно отметить, что при $0\le \beta<1$ сумма весов равна 1:

$$
\sum_{j=0}^{\infty}(1-\beta)\beta^{j}=1,
$$

то есть $m_{t+1}$ — это экспоненциальное скользящее среднее градиентов.